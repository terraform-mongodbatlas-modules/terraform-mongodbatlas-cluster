# SDLC Sync Configuration
# See contributing/sdlc-sync.md for documentation on how this sync mechanism works
name: sdlc
src_repo_url: https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-cluster
pr_defaults:
  title: 'chore: sync {name} files'
  body_suffix: |
    - This PR was generated by [path-sync](https://github.com/EspenAlbert/path-sync).
    - For details on how this sync mechanism works, see [contributing/sdlc-sync.md](https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-cluster/blob/main/contributing/sdlc-sync.md).
    
    - To merge this PR, only check that the CI Checks are passing, no need to review the changes (they have been approved in the src repo)
    - If you need to make changes, see the [Change Request Options](https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-cluster/blob/main/contributing/sdlc-sync.md#change-request-options) in the SDLC Sync Guide.
    - tl;dr:
    
    1. Changes to any file NOT managed by path-sync is OK
    2. Changes to any file managed by path-sync should be made in the source repository

    How do you know if a file was managed by path-sync?
    
    1. Look at the 1st line of the file, if it has `# path-sync copy -n sdlc` it means it is managed by path-sync
    2. Or look in the src repo for the `.github/sdlc.src.yaml` file that contains the mapping of files to sync.
verify:
  steps:
    - run: just uv-sync
    - run: just docs
      commit:
        message: "chore: docs after sdlc-sync"
        add_paths: ["."]

paths:
  - src_path: .gitignore
  # Python tooling - explicit folders (avoid .venv)
  - src_path: .github/changelog/*.py
  - src_path: .github/changelog/*.txt
    sync_mode: replace
  - src_path: .github/changelog/*.tmpl
    sync_mode: replace
  - src_path: .github/changelog/check-changelog-entry-file/*.go
  - src_path: .github/changelog/check-changelog-entry-file/go.mod
    sync_mode: replace
  - src_path: .github/changelog/check-changelog-entry-file/go.sum
    sync_mode: replace
  - src_path: .github/docs/
  - src_path: .github/release/
  - src_path: .github/pyproject.toml
  - src_path: .github/uv.lock
  - src_path: .github/workspace/
  - src_path: .github/dev/__init__.py
  - src_path: .github/dev/extract_regions.py
  - src_path: .github/dev/.gitignore
  - src_path: .github/dev/test_compat.py
  # NOTE: dev_vars.py is NOT synced - see scaffolded files below
  # Workflows & actions
  - src_path: .github/workflows/check-changelog-entry-file.yml
  - src_path: .github/workflows/code-health.yml
  - src_path: .github/workflows/generate-changelog.yml
  - src_path: .github/workflows/notify-docs-team.yml
  - src_path: .github/workflows/release.yml
  - src_path: .github/workflows/update-terraform-versions.yml
  - src_path: .github/workflows/validate-region-mappings.yml
  - src_path: .github/workflows_destination/sdlc_validate.yaml
    dest_path: .github/workflows/sdlc-validate.yml
  - src_path: .github/actions/
  # Contributing guides
  - src_path: contributing/sdlc-sync.md
  - src_path: contributing/changelog-process.md
  - src_path: contributing/documentation-guide.md
  - src_path: contributing/README.md
  # GitHub config
  - src_path: .github/CODEOWNERS
    sync_mode: replace
  - src_path: .github/pull_request_template.md
    sync_mode: replace
  - src_path: .github/ISSUE_TEMPLATE/
    sync_mode: replace
  # Justfile with sections (see justfile for section names)
  # Sections: header, core, checks, dev-setup, formatting, linting, testing-unit,
  #           docs, changelog, release, workspace, provider-dev, dev-vars-org,
  #           regions, testing-tf, sdlc-validate
  - src_path: justfile
  - src_path: .pre-commit-config.yaml
  # Terraform docs & config
  - src_path: .terraform-versions.yaml
  # Scaffolded files (only synced if not existing)
  - src_path: CONTRIBUTING.md
    sync_mode: scaffold
  - src_path: .changelog/.gitkeep
    sync_mode: scaffold
  - src_path: .github/destination_scaffold/empty-changelog.md
    dest_path: CHANGELOG.md
    sync_mode: scaffold
  - src_path: .github/destination_scaffold/examples.yaml
    dest_path: docs/examples.yaml
    sync_mode: scaffold
  - src_path: .github/destination_scaffold/inputs_groups.yaml
    dest_path: docs/inputs_groups.yaml
    sync_mode: scaffold
  - src_path: docs/example_readme.md
    sync_mode: scaffold
  - src_path: .github/destination_scaffold/.terraform-docs.yml
    dest_path: .terraform-docs.yml
    sync_mode: scaffold
  - src_path: .github/dev/dev_vars.py # usually each module needs its own dev.tfvars generation
destinations:
  - name: aws
    repo_url: https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-atlas-aws
    dest_path_relative: ../aws
    default_branch: main
    skip_file_patterns:
      - ".github/dev/.gitignore"
      - ".github/dev/extract_regions.py"
      - ".github/workflows/validate-region-mappings.yml"
    skip_sections:
      justfile: [dev-vars-org, regions]  # AWS doesn't need org vars or region extraction
  - name: azure
    repo_url: https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-atlas-azure
    dest_path_relative: ../azure
    default_branch: main
    skip_sections:
      justfile: [dev-vars-org]  # Azure needs regions but not org vars
  - name: project
    repo_url: https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-project
    dest_path_relative: ../project
    default_branch: main
    skip_file_patterns:
      - ".github/dev/.gitignore"
      - ".github/dev/extract_regions.py"
      - ".github/workflows/validate-region-mappings.yml"
    skip_sections:
      justfile: [regions]  # Project needs org vars but not region extraction
  - name: gcp
    repo_url: https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-atlas-gcp
    dest_path_relative: ../gcp
    default_branch: main
    skip_sections:
      justfile: [dev-vars-org]  # GCP needs regions but not org vars
      .github/workflows/code-health.yml: [job-snapshot-tests, job-slack]  # Enable when workspace tests exist
  - name: org
    repo_url: https://github.com/terraform-mongodbatlas-modules/terraform-mongodbatlas-organization
    dest_path_relative: ../org
    default_branch: main
    skip_file_patterns:
      - ".github/dev/.gitignore"
      - ".github/dev/extract_regions.py"
      - ".github/workflows/validate-region-mappings.yml"
    skip_sections:
      justfile: [dev-vars-org, regions]  # Org doesn't need org vars or region extraction
      .github/workflows/code-health.yml: [job-snapshot-tests, job-slack]  # Enable when workspace tests exist
